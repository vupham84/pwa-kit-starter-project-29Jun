"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[766],{64671:(e,t,r)=>{r.r(t),r.d(t,{default:()=>st});var a=r(28407),n=r(77810),s=r(34692),l=r(41863),i=r(59146),o=r(69290),d=r(75828),c=r(9e4),u=r(65958),p=r(34466),m=r(76944),g=r(28137),f=r(84470),y=r(10939),E=r(75826),b=r.n(E),h=r(72105),v=r(5332),_=r(72326);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach(function(t){(0,y.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const I=n.createContext(),C=({children:e})=>{var t,r,a;const{data:s}=(0,v.J)(),{data:l}=(0,_.X)(),i=(0,h.A)(),[o,d]=(0,n.useState)(),c=["CONTACT_INFO","SHIPPING_ADDRESS","SHIPPING_OPTIONS","PAYMENT","REVIEW_ORDER"],u=c.reduce((e,t,r)=>S(S({},e),{},{[t]:r}),{});(0,n.useEffect)(()=>{var e,t,r;if(!s||!l)return;let a=u.REVIEW_ORDER;!s.isGuest||null!==(e=l.customerInfo)&&void 0!==e&&e.email?null!==(t=l.shipments[0])&&void 0!==t&&t.shippingAddress?null!==(r=l.shipments[0])&&void 0!==r&&r.shippingMethod?l.paymentInstruments&&l.billingAddress||(a=u.PAYMENT):a=u.SHIPPING_OPTIONS:a=u.SHIPPING_ADDRESS:a=u.CONTACT_INFO,d(a)},[null==s?void 0:s.isGuest,null==l||null===(t=l.customerInfo)||void 0===t?void 0:t.email,null==l||null===(r=l.shipments[0])||void 0===r?void 0:r.shippingAddress,null==l||null===(a=l.shipments[0])||void 0===a?void 0:a.shippingMethod,null==l?void 0:l.paymentInstruments,null==l?void 0:l.billingAddress]),(0,n.useEffect)(()=>{null!=l&&l.productItems&&i.sendBeginCheckout(l)},[]),(0,n.useEffect)(()=>{null!=o&&i.sendCheckoutStep((e=>c[e])(o),o,l)},[o]);const p={step:o,STEPS:u,goToNextStep:()=>d(o+1),goToStep:e=>d(e)};return n.createElement(I.Provider,{value:p},e)};C.propTypes={children:b().any};const M=()=>n.useContext(I);var O=r(64180),k=r(21052),P=r(19744),w=r(10697),x=r(5444),B=r(95323),T=r(40714),L=r(49785),N=r(68095),j=r(32432),D=r(89891),R=r(99378),$=r(31348);const F=({form:e,handlePasswordlessLoginClick:t,isSocialEnabled:r,isPasswordlessEnabled:a,idps:s,showPasswordField:i,togglePasswordField:o})=>{const[d,c]=(0,n.useState)(!0);return r||a?d?n.createElement(n.Fragment,null,n.createElement(R.c,null),n.createElement(k.E,{align:"center",fontSize:"sm",marginTop:2,marginBottom:2},n.createElement(l.A,{defaultMessage:[{type:0,value:"Or Login With"}],id:"contact_info.message.or_login_with"})),a&&n.createElement(g.$,{variant:"outline",borderColor:"gray.500",type:"submit",onClick:()=>{t()},isLoading:e.formState.isSubmitting},n.createElement(l.A,{defaultMessage:[{type:0,value:"Secure Link"}],id:"contact_info.button.secure_link"})),!i&&n.createElement(g.$,{variant:"outline",borderColor:"gray.500",onClick:()=>{o(),c(!d)}},n.createElement(l.A,{defaultMessage:[{type:0,value:"Password"}],id:"contact_info.button.password"})),r&&s&&n.createElement($.A,{form:e,idps:s})):n.createElement(g.$,{variant:"outline",borderColor:"gray.500",onClick:()=>{o(),c(!d)}},n.createElement(l.A,{defaultMessage:[{type:0,value:"Back to Sign In Options"}],id:"contact_info.button.back_to_sign_in_options"})):n.createElement(g.$,{variant:"outline",borderColor:"gray.500",onClick:o},i?n.createElement(l.A,{defaultMessage:[{type:0,value:"Checkout as Guest"}],id:"contact_info.button.checkout_as_guest"}):n.createElement(l.A,{defaultMessage:[{type:0,value:"Already have an account? Log in"}],id:"contact_info.button.already_have_account"}))};F.propTypes={form:b().object,handlePasswordlessLoginClick:b().func,isSocialEnabled:b().bool,isPasswordlessEnabled:b().bool,idps:b().arrayOf(b().string),showPasswordField:b().bool,togglePasswordField:b().func};const z=F;var V=r(94570),G=r(17878),H=r(30056),q=r(90031),W=r(4026),U=r(66322);const X=({isSocialEnabled:e=!1,isPasswordlessEnabled:t=!1,idps:r=[]})=>{var d,c,y,E;const{formatMessage:b}=(0,s.A)(),h=(0,f.A)(),{data:A}=(0,v.J)(),{data:S}=(0,_.X)(),I=(0,H.$)(),C=(0,q.useAuthHelper)(q.AuthHelpers.LoginRegisteredUserB2C),P=(0,q.useAuthHelper)(q.AuthHelpers.Logout),w=(0,q.useAuthHelper)(q.AuthHelpers.AuthorizePasswordless),x=(0,q.useShopperBasketsMutation)("updateCustomerForBasket"),B=(0,q.useShopperBasketsMutation)("mergeBasket"),{step:T,STEPS:R,goToStep:$,goToNextStep:F}=M(),X=(0,L.mN)({defaultValues:{email:(null==A?void 0:A.email)||(null==S||null===(d=S.customerInfo)||void 0===d?void 0:d.email)||"",password:""}}),K=(0,N.A)({form:X}),J=(0,n.useRef)(),[Q,Z]=(0,n.useState)(null),[ee,te]=(0,n.useState)(!1),[re,ae]=(0,n.useState)(!1),[ne,se]=(0,n.useState)(V.aK),le=(0,V.Xi)(ne),[ie,oe]=(0,n.useState)(!1),de=null===(c=(0,W.getConfig)().app.login)||void 0===c||null===(y=c.passwordless)||void 0===y?void 0:y.callbackURI,ce=(0,G.n)(de)?de:`${I}${de}`,ue=function(){var e=(0,a.A)(function*(e){try{const t=window.location.pathname+(window.location.search||"");yield w.mutateAsync({userid:e,callbackURI:`${ce}?redirectUrl=${t}`}),se(V.fX),le.onOpen()}catch(e){const t=U.C5.test(e.message)?b(U.j$):U.Fk.some(t=>t.test(e.message))?b(U.vn):b(U.gS);Z(t)}});return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=(0,a.A)(function*(e){if(Z(null),ie)return ue(e.email),void oe(!1);try{var t;if(e.password)yield C.mutateAsync({username:e.email,password:e.password}),(null===(t=S.productItems)||void 0===t?void 0:t.length)>0&&B.mutate({parameters:{createDestinationBasket:!0}});else yield x.mutateAsync({parameters:{basketId:S.basketId},body:{email:e.email}});F()}catch(e){/Unauthorized/i.test(e.message)?Z(b({defaultMessage:[{type:0,value:"Incorrect username or password, please try again."}],id:"contact_info.error.incorrect_username_or_password"})):Z(e.message)}});return function(t){return e.apply(this,arguments)}}();(0,n.useEffect)(()=>{ee||X.unregister("password")},[ee]);const me=function(){var e=(0,a.A)(function*(){oe(!0)});return function(){return e.apply(this,arguments)}}();return n.createElement(j.Le,{id:"step-0",title:b({defaultMessage:[{type:0,value:"Contact Info"}],id:"contact_info.title.contact_info"}),editing:T===R.CONTACT_INFO,isLoading:X.formState.isSubmitting,onEdit:()=>{A.isRegistered?ae(!0):$(R.CONTACT_INFO)},editLabel:A.isRegistered?b({defaultMessage:[{type:0,value:"Sign Out"}],id:"contact_info.action.sign_out"}):b({defaultMessage:[{type:0,value:"Edit Contact Info"}],id:"toggle_card.action.editContactInfo"})},n.createElement(j.hl,null,n.createElement(o.m,{variant:"form"},n.createElement("form",{onSubmit:X.handleSubmit(pe)},n.createElement(u.B,{spacing:6},Q&&n.createElement(p.F,{status:"error"},n.createElement(m._,null),Q),n.createElement(u.B,{spacing:5,position:"relative"},n.createElement(D.A,(0,O.A)({},K.email,{inputRef:J})),ee&&n.createElement(u.B,null,n.createElement(D.A,K.password),n.createElement(i.a,null,n.createElement(g.$,{variant:"link",size:"sm",onClick:()=>{se(V.aK),le.onOpen()}},n.createElement(l.A,{defaultMessage:[{type:0,value:"Forgot password?"}],id:"contact_info.link.forgot_password"}))))),n.createElement(u.B,{spacing:3},n.createElement(g.$,{type:"submit"},ee?n.createElement(l.A,{defaultMessage:[{type:0,value:"Log In"}],id:"contact_info.button.login"}):n.createElement(l.A,{defaultMessage:[{type:0,value:"Checkout as Guest"}],id:"contact_info.button.checkout_as_guest"})),n.createElement(z,{form:X,isSocialEnabled:e,isPasswordlessEnabled:t,idps:r,showPasswordField:ee,togglePasswordField:()=>{Q&&Z(null),te(!ee),J.current&&J.current.focus()},handlePasswordlessLoginClick:me}))))),n.createElement(V.Ux,(0,O.A)({},le,{initialEmail:X.getValues().email}))),n.createElement(j.vr,null,n.createElement(k.E,null,(null==S||null===(E=S.customerInfo)||void 0===E?void 0:E.email)||(null==A?void 0:A.email)),n.createElement(Y,{isOpen:re,onClose:()=>ae(!1),onConfirm:(0,a.A)(function*(){yield P.mutateAsync(),h("/login"),ae(!1)})})))};X.propTypes={isSocialEnabled:b().bool,isPasswordlessEnabled:b().bool,idps:b().arrayOf(b().string)};const Y=({isOpen:e,onConfirm:t,onClose:r})=>{const a=(0,n.useRef)();return n.createElement(P.Lt,{isOpen:e,leastDestructiveRef:a,onClose:r},n.createElement(w.m,null,n.createElement(P.EO,null,n.createElement(x.r,{fontSize:"lg",fontWeight:"bold"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Sign Out"}],id:"signout_confirmation_dialog.heading.sign_out"})),n.createElement(B.c,null,n.createElement(l.A,{defaultMessage:[{type:0,value:"Are you sure you want to sign out? You will need to sign back in to proceed with your current order."}],id:"signout_confirmation_dialog.message.sure_to_sign_out"})),n.createElement(T.j,null,n.createElement(g.$,{ref:a,variant:"outline",onClick:r},n.createElement(l.A,{defaultMessage:[{type:0,value:"Cancel"}],id:"signout_confirmation_dialog.button.cancel"})),n.createElement(g.$,{colorScheme:"red",onClick:t,ml:3},n.createElement(l.A,{defaultMessage:[{type:0,value:"Sign Out"}],id:"signout_confirmation_dialog.button.sign_out"}))))))};Y.propTypes={isOpen:b().bool,onClose:b().func,onConfirm:b().func};const K=X;var J=r(27869),Q=r(16602),Z=r(18801),ee=r(85353),te=r(3411),re=r(1188),ae=r(86708),ne=r(4814),se=r(62345);const le=n.createContext(),ie=e=>{const t=n.useContext(le),{getInputProps:r,getRadioProps:a}=(0,ae.z)(t(e)),s=r(),l=a();return n.createElement(i.a,{as:"label"},n.createElement("input",s),n.createElement(i.a,(0,O.A)({},l,{"aria-hidden":!1,position:"relative",cursor:"pointer",border:"1px solid",borderColor:"gray.200",borderRadius:"base",height:"full",_checked:{borderColor:"blue.600"},_focus:{boxShadow:"outline"},px:4,py:4}),s.checked&&n.createElement(i.a,{position:"absolute",top:0,right:0,w:0,h:0,borderStyle:"solid",borderWidth:"0 38px 38px 0",borderColor:"transparent",borderRightColor:"blue.600"},n.createElement(se.Sr,{color:"white",position:"absolute",right:"-40px",top:"1px"})),e.children))},oe=e=>{const{getRootProps:t,getRadioProps:r}=(0,ne.m)(e),a=t();return n.createElement(le.Provider,{value:r},n.createElement(i.a,a,e.children))};ie.propTypes={children:b().any},oe.propTypes={children:b().any};var de=r(90734),ce=r(32574),ue=r(95641),pe=r(41443),me=r(38755);const ge=["addressId","creationDate","lastModified","preferred"],fe=["id","_type"];function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach(function(t){(0,y.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const be=(0,Q.zR)({defaultMessage:[{type:0,value:"Save & Continue to Shipping Method"}],id:"shipping_address_edit_form.button.save_and_continue"}),he=({title:e,hasSavedAddresses:t,toggleAddressEdit:r,hideSubmitButton:a,form:l,submitButtonLabel:d,formTitleAriaLabel:c,isBillingAddress:p=!1})=>{const{formatMessage:m}=(0,s.A)();return n.createElement(i.a,(0,O.A)({},t&&!p&&{gridColumn:[1,1,"span 2"],paddingX:[4,4,6],paddingY:6,rounded:"base",border:"1px solid",borderColor:"blue.600"},{"data-testid":"sf-shipping-address-edit-form"}),n.createElement(u.B,{spacing:6},t&&!p&&n.createElement(ee.D,{as:"h3",size:"sm"},e),n.createElement(u.B,{spacing:6},n.createElement(ue.A,{form:l,formTitleAriaLabel:c,isBillingAddress:p}),t&&!a?n.createElement(pe.A,{saveButtonLabel:be,onCancel:r}):!a&&n.createElement(i.a,null,n.createElement(o.m,{variant:"form"},n.createElement(g.$,{type:"submit",width:"full",disabled:l.formState.isSubmitting},m(d)))))))};he.propTypes={title:b().string,hasSavedAddresses:b().bool,toggleAddressEdit:b().func,hideSubmitButton:b().bool,form:b().object,submitButtonLabel:me.O2,formTitleAriaLabel:me.O2,isBillingAddress:b().bool};const ve=(0,Q.zR)({defaultMessage:[{type:0,value:"Submit"}],id:"shipping_address_selection.button.submit"}),_e=({form:e,selectedAddress:t,submitButtonLabel:r=ve,formTitleAriaLabel:d,hideSubmitButton:c=!1,onSubmit:p=(0,a.A)(function*(){return null}),isBillingAddress:m=!1})=>{var f;const{formatMessage:y}=(0,s.A)(),{data:E,isLoading:b,isFetching:h}=(0,v.J)(),_=b&&h,A=(null===(f=E.addresses)||void 0===f?void 0:f.length)>0,[S,I]=(0,n.useState)(!1),[C,M]=(0,n.useState)(void 0),[O,k]=(0,n.useState)({});(0,n.useEffect)(()=>{var e;const t={};null===(e=E.addresses)||void 0===e||e.forEach(({addressId:e})=>{t[e]=n.createRef()}),k(t)},[E.addresses]);const P=(0,L.mN)({mode:"onChange",shouldUnregister:!1,defaultValues:Ee({},t)});e||(e=P);const w=A&&t&&E.addresses.find(e=>{const{addressId:r,creationDate:a,lastModified:n,preferred:s}=e,l=(0,Z.A)(e,ge),{id:i,_type:o}=t,d=(0,Z.A)(t,fe);return(0,re.Gh)(l,d)}),x=(0,q.useShopperCustomersMutation)("removeCustomerAddress");(0,n.useEffect)(()=>{if(m)e.reset(Ee({},t));else if(E.addresses){const t=E.addresses.find(e=>!0===e.preferred);t&&e.reset(Ee({},t))}},[]),(0,n.useEffect)(()=>{b||null!=E&&E.addresses||S||I(!0)},[E]),(0,n.useEffect)(()=>{w&&e.reset(Ee({addressId:w.addressId},w)),!w&&C&&I(!0)},[w]);const B=function(){var t=(0,a.A)(function*(t){C&&(t=Ee(Ee({},t),{},{addressId:C})),I(!1),e.reset({addressId:""}),yield p(t)});return function(e){return t.apply(this,arguments)}}(),T=t=>{t&&S&&I(!1);const r=E.addresses.find(e=>e.addressId===t);e.reset(Ee({},r))},N=y({defaultMessage:[{type:0,value:"Shipping Address"}],id:"shipping_address.title.shipping_address"}),j=Array.from(document.querySelectorAll("h2")).find(e=>e.textContent===N),D=function(){var t=(0,a.A)(function*(t){t===C&&(M(void 0),I(!1),e.reset({addressId:""})),yield x.mutateAsync({parameters:{customerId:E.customerId,addressName:t}},{onSuccess:()=>{null==j||j.focus()}})});return function(e){return t.apply(this,arguments)}}(),R=(t=void 0)=>{if(null!=t&&t.addressId)M(t.addressId),e.reset(Ee({},t)),I(!0);else{var r;const t=(null===(r=O[C])||void 0===r?void 0:r.current)??j;null==t||t.focus(),M(void 0),e.reset({addressId:""}),I(!S)}e.trigger()};return _?null:n.createElement("form",{onSubmit:e.handleSubmit(B)},n.createElement(u.B,{spacing:4},A&&!m&&n.createElement(L.xI,{name:"addressId",defaultValue:"",control:e.control,rules:{required:!S},render:({field:{value:t}})=>{var a;return n.createElement(oe,{value:t,onChange:T},n.createElement(te.r,{columns:[1,1,2],spacing:4,gridAutoFlow:"row dense"},null===(a=E.addresses)||void 0===a?void 0:a.map((t,a)=>{const s=y({defaultMessage:[{type:0,value:"Edit "},{type:1,value:"address"}],id:"shipping_address.label.edit_button"},{address:t.address1}),l=y({defaultMessage:[{type:0,value:"Remove "},{type:1,value:"address"}],id:"shipping_address.label.remove_button"},{address:t.address1});return n.createElement(n.Fragment,{key:t.addressId},n.createElement(ie,{value:t.addressId},n.createElement(de.A,{padding:0,border:"none",onRemove:()=>D(t.addressId),onEdit:()=>R(t),editBtnRef:O[t.addressId],"data-testid":`sf-checkout-shipping-address-${a}`,editBtnLabel:s,removeBtnLabel:l},n.createElement(ce.A,{address:t})),S&&t.addressId===C&&n.createElement(i.a,{width:3,height:3,borderLeft:"1px solid",borderTop:"1px solid",borderColor:"blue.600",position:"absolute",left:"50%",bottom:"-23px",background:"white",transform:"rotate(45deg)"})),S&&t.addressId===C&&n.createElement(he,{title:y({defaultMessage:[{type:0,value:"Edit Shipping Address"}],id:"shipping_address_selection.title.edit_shipping"}),hasSavedAddresses:A,toggleAddressEdit:R,hideSubmitButton:c,form:e,submitButtonLabel:r,formTitleAriaLabel:d}))}),n.createElement(g.$,{variant:"outline",border:"1px dashed",borderColor:"gray.200",color:"blue.600",height:["44px","44px","167px"],rounded:"base",fontWeight:"medium",leftIcon:n.createElement(se.c1,{boxSize:"15px"}),onClick:R},n.createElement(l.A,{defaultMessage:[{type:0,value:"Add New Address"}],id:"shipping_address_selection.button.add_address"}),S&&!C&&n.createElement(i.a,{width:3,height:3,borderLeft:"1px solid",borderTop:"1px solid",borderColor:"blue.600",position:"absolute",left:"50%",bottom:"-23px",background:"white",transform:"rotate(45deg)"}))))}}),((null==E?void 0:E.isGuest)||S&&!C||m)&&n.createElement(he,{title:y({defaultMessage:[{type:0,value:"Add New Address"}],id:"shipping_address_selection.title.add_address"}),hasSavedAddresses:A,toggleAddressEdit:R,hideSubmitButton:c,form:e,isBillingAddress:m,submitButtonLabel:r,formTitleAriaLabel:d}),E.isRegistered&&!S&&!c&&n.createElement(i.a,{pt:2},n.createElement(o.m,{variant:"form"},n.createElement(g.$,{type:"submit",width:"full",disabled:!e.formState.isValid||e.formState.isSubmitting},y(r))))))};_e.propTypes={form:b().object,selectedAddress:b().object,submitButtonLabel:me.O2,formTitleAriaLabel:me.O2,hideSubmitButton:b().bool,onSubmit:b().func,isBillingAddress:b().bool};const Ae=_e,Se=(0,Q.zR)({defaultMessage:[{type:0,value:"Continue to Shipping Method"}],id:"shipping_address.button.continue_to_shipping"}),Ie=(0,Q.zR)({defaultMessage:[{type:0,value:"Shipping Address Form"}],id:"shipping_address.label.shipping_address_form"});function Ce(){var e;const{formatMessage:t}=(0,s.A)(),[r,l]=(0,n.useState)(),{data:i}=(0,v.J)(),{data:o}=(0,_.X)(),d=(null==o?void 0:o.shipments)&&(null==o||null===(e=o.shipments[0])||void 0===e?void 0:e.shippingAddress),{step:c,STEPS:u,goToStep:p,goToNextStep:m}=M(),g=(0,q.useShopperCustomersMutation)("createCustomerAddress"),f=(0,q.useShopperCustomersMutation)("updateCustomerAddress"),y=(0,q.useShopperBasketsMutation)("updateShippingAddressForShipment"),E=function(){var e=(0,a.A)(function*(e){l(!0);const{addressId:t,address1:r,city:a,countryCode:n,firstName:s,lastName:d,phone:c,postalCode:u,stateCode:p}=e;if(yield y.mutateAsync({parameters:{basketId:o.basketId,shipmentId:"me",useAsBilling:!1},body:{address1:r,city:a,countryCode:n,firstName:s,lastName:d,phone:c,postalCode:u,stateCode:p}}),i.isRegistered&&!t){const e={address1:r,city:a,countryCode:n,firstName:s,lastName:d,phone:c,postalCode:u,stateCode:p,addressId:(0,J.Ak)()};yield g.mutateAsync({body:e,parameters:{customerId:i.customerId}})}i.isRegistered&&t&&(yield f.mutateAsync({body:e,parameters:{customerId:i.customerId,addressName:t}})),m(),l(!1)});return function(t){return e.apply(this,arguments)}}();return n.createElement(j.Le,{id:"step-1",title:t({defaultMessage:[{type:0,value:"Shipping Address"}],id:"shipping_address.title.shipping_address"}),editing:c===u.SHIPPING_ADDRESS,isLoading:r,disabled:c===u.CONTACT_INFO&&!d,onEdit:()=>p(u.SHIPPING_ADDRESS),editLabel:t({defaultMessage:[{type:0,value:"Edit Shipping Address"}],id:"toggle_card.action.editShippingAddress"})},n.createElement(j.hl,null,n.createElement(Ae,{selectedAddress:d,submitButtonLabel:Se,onSubmit:E,formTitleAriaLabel:Ie})),d&&n.createElement(j.vr,null,n.createElement(ce.A,{address:d})))}var Me=r(22400),Oe=r(42458),ke=r(67234),Pe=r(45495);function we(){var e,t,r,d,c,p;const{formatMessage:m}=(0,s.A)(),{step:f,STEPS:y,goToStep:E,goToNextStep:b}=M(),{data:h}=(0,_.X)(),{currency:v}=(0,Pe.H2)(),A=(0,q.useShopperBasketsMutation)("updateShippingMethodForShipment"),{data:S}=(0,q.useShippingMethodsForShipment)({parameters:{basketId:null==h?void 0:h.basketId,shipmentId:"me"}},{enabled:Boolean(null==h?void 0:h.basketId)&&f===y.SHIPPING_OPTIONS}),I=null==h||null===(e=h.shipments)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.shippingMethod,C=null==h||null===(r=h.shipments)||void 0===r||null===(d=r[0])||void 0===d?void 0:d.shippingAddress,O=(0,L.mN)({shouldUnregister:!1,defaultValues:{shippingMethodId:(null==I?void 0:I.id)||(null==S?void 0:S.defaultShippingMethodId)}});(0,n.useEffect)(()=>{const e=null==S?void 0:S.defaultShippingMethodId,t=O.getValues().shippingMethodId;I||t||!e||O.reset({shippingMethodId:e}),I&&t!==I.id&&O.reset({shippingMethodId:I.id})},[I,S]);const P=function(){var e=(0,a.A)(function*({shippingMethodId:e}){yield A.mutateAsync({parameters:{basketId:h.basketId,shipmentId:"me"},body:{id:e}}),b()});return function(t){return e.apply(this,arguments)}}(),w=null==h||null===(c=h.shippingItems)||void 0===c?void 0:c[0],x=Math.min((null==w?void 0:w.price)||0,(null==w?void 0:w.priceAfterItemDiscount)||0),B=m({defaultMessage:[{type:0,value:"Free"}],id:"checkout_confirmation.label.free"});let T=x;if(x!==w.price){const e=0===x?B:x;T=m({defaultMessage:[{type:0,value:"Originally "},{type:1,value:"originalPrice"},{type:0,value:", now "},{type:1,value:"newPrice"}],id:"checkout_confirmation.label.shipping.strikethrough.price"},{originalPrice:w.price,newPrice:e})}return n.createElement(j.Le,{id:"step-2",title:m({defaultMessage:[{type:0,value:"Shipping & Gift Options"}],id:"shipping_options.title.shipping_gift_options"}),editing:f===y.SHIPPING_OPTIONS,isLoading:O.formState.isSubmitting,disabled:null==I||!C,onEdit:()=>E(y.SHIPPING_OPTIONS),editLabel:m({defaultMessage:[{type:0,value:"Edit Shipping Options"}],id:"toggle_card.action.editShippingOptions"})},n.createElement(j.hl,null,n.createElement("form",{onSubmit:O.handleSubmit(P),"data-testid":"sf-checkout-shipping-options-form"},n.createElement(u.B,{spacing:6},(null==S?void 0:S.applicableShippingMethods)&&n.createElement(L.xI,{name:"shippingMethodId",control:O.control,defaultValue:"",render:({field:{value:e,onChange:t}})=>n.createElement(Me.z,{name:"shipping-options-radiogroup",value:e,onChange:t},n.createElement(u.B,{spacing:5},S.applicableShippingMethods.map(e=>{var t;return n.createElement(Oe.s,{value:e.id,key:e.id},n.createElement(ke.s,{justify:"space-between",w:"full"},n.createElement(i.a,null,n.createElement(k.E,null,e.name),n.createElement(k.E,{fontSize:"sm",color:"gray.600"},e.description)),n.createElement(k.E,{fontWeight:"bold"},n.createElement(Q.Gr,{value:e.price,style:"currency",currency:v}))),null===(t=e.shippingPromotions)||void 0===t?void 0:t.map(e=>n.createElement(k.E,{key:e.promotionId,fontSize:"sm",color:"green.600"},e.calloutMsg)))})))}),n.createElement(i.a,null,n.createElement(g.$,{variant:"link",size:"sm",rightIcon:n.createElement(se.D3,null)},n.createElement(l.A,{defaultMessage:[{type:0,value:"Do you want to send this as a gift?"}],id:"shipping_options.action.send_as_a_gift"}))),n.createElement(i.a,null,n.createElement(o.m,{variant:"form"},n.createElement(g.$,{w:"full",type:"submit"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Continue to Payment"}],id:"shipping_options.button.continue_to_payment"}))))))),I&&C&&n.createElement(j.vr,null,n.createElement(ke.s,{justify:"space-between",w:"full"},n.createElement(k.E,null,I.name),n.createElement(ke.s,{alignItems:"center","aria-label":T},n.createElement(k.E,{fontWeight:"bold","aria-hidden":"true"},0===x?B:n.createElement(Q.Gr,{value:x,style:"currency",currency:v})),x!==w.price&&n.createElement(k.E,{fontWeight:"normal",textDecoration:"line-through",color:"gray.600",marginLeft:1,"aria-hidden":"true"},n.createElement(Q.Gr,{style:"currency",currency:v,value:w.price})))),n.createElement(k.E,{fontSize:"sm",color:"gray.700"},I.description),null==w||null===(p=w.priceAdjustments)||void 0===p?void 0:p.map(e=>n.createElement(k.E,{key:e.priceAdjustmentId,fontSize:"sm",color:"green.600"},e.itemText))))}var xe=r(83527),Be=r(12109),Te=r(41159),Le=r(5639),Ne=r(35527),je=r.n(Ne),De=r(6277),Re=r(8129);const $e=(0,Q.YK)({required:{defaultMessage:[{type:0,value:"Required"}],id:"use_credit_card_fields.error.required"},cardNumberInvalid:{defaultMessage:[{type:0,value:"Please enter a valid card number."}],id:"use_credit_card_fields.error.valid_card_number"},nameInvalid:{defaultMessage:[{type:0,value:"Please enter a valid name."}],id:"use_credit_card_fields.error.valid_name"},dateInvalid:{defaultMessage:[{type:0,value:"Please enter a valid date."}],id:"use_credit_card_fields.error.valid_date"},codeInvalid:{defaultMessage:[{type:0,value:"Please enter a valid security code."}],id:"use_credit_card_fields.error.valid_security_code"},cardNumber:{defaultMessage:[{type:0,value:"Card Number"}],id:"use_credit_card_fields.label.card_number"},cardType:{defaultMessage:[{type:0,value:"Card Type"}],id:"use_credit_card_fields.label.card_type"},cardName:{defaultMessage:[{type:0,value:"Name on Card"}],id:"use_credit_card_fields.label.name"},expiryDate:{defaultMessage:[{type:0,value:"Expiration Date"}],id:"use_credit_card_fields.label.expiry"},securityCode:{defaultMessage:[{type:0,value:"Security Code"}],id:"use_credit_card_fields.label.security_code"}});function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach(function(t){(0,y.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Ve=({form:e,prefix:t=""})=>{var r;const{formatMessage:a}=(0,s.A)(),[l,o]=(0,n.useState)(!1),d=function({form:{control:e,formState:{errors:t}},prefix:r=""}){const{formatMessage:a}=(0,s.A)();return{number:{name:`${r}number`,label:a($e.cardNumber),defaultValue:"",type:"text",autoComplete:"cc-number",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your card number."}],id:"use_credit_card_fields.error.required_card_number"}),validate:e=>je().number(e).isValid||a($e.cardNumberInvalid)},error:t[`${r}number`],inputProps:{inputMode:"numeric"},control:e},cardType:{name:`${r}cardType`,label:a($e.cardType),defaultValue:"",type:"hidden",error:t[`${r}cardType`],control:e},holder:{name:`${r}holder`,label:a($e.cardName),defaultValue:"",type:"text",autoComplete:"cc-name",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your name as shown on your card."}],id:"use_credit_card_fields.error.required_name"}),validate:e=>je().cardholderName(e).isValid||a($e.nameInvalid)},error:t[`${r}holder`],control:e},expiry:{name:`${r}expiry`,label:a($e.expiryDate),defaultValue:"",type:"text",autoComplete:"cc-exp",placeholder:"MM/YY",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your expiration date."}],id:"use_credit_card_fields.error.required_expiry"}),validate:e=>je().expirationDate(e).isValid||a($e.dateInvalid)},error:t[`${r}expiry`],inputProps:{inputMode:"numeric"},control:e},securityCode:{name:`${r}securityCode`,label:a($e.securityCode),defaultValue:"",type:"password",autoComplete:"off",rules:{required:a({defaultMessage:[{type:0,value:"Please enter your security code."}],id:"use_credit_card_fields.error.required_security_code"}),validate:e=>je().cvv(e).isValid||a($e.codeInvalid)},error:t[`${r}securityCode`],inputProps:({onChange:e})=>({inputMode:"numeric",maxLength:4,onChange(t){e(t.target.value.replace(/[^0-9 ]+/,""))}}),control:e}}}({form:e,prefix:t}),c=e.watch("cardType"),p=(0,Te.N0)(e.getValues().cardType),m=a("american-express"===c?{id:"credit_card_fields.tool_tip.security_code.american_express",defaultMessage:[{type:0,value:"This 4-digit code can be found on the front of your card."}]}:{id:"credit_card_fields.tool_tip.security_code",defaultMessage:[{type:0,value:"This 3-digit code can be found on the back of your card."}]}),g=()=>{o(!1),document&&(document.removeEventListener("click",g),document.removeEventListener("keydown",g))},f=()=>{o(!0),document&&(document.addEventListener("click",g),document.addEventListener("keydown",g))};return n.createElement(i.a,null,n.createElement(u.B,{spacing:5},n.createElement(D.A,(0,O.A)({},d.number,{formLabel:n.createElement(ke.s,{justify:"space-between"},n.createElement(De.l,null,d.number.label),n.createElement(u.B,{direction:"row",spacing:1},n.createElement(se.nL,{layerStyle:"ccIcon"}),n.createElement(se.uI,{layerStyle:"ccIcon"}),n.createElement(se.Nx,{layerStyle:"ccIcon"}),n.createElement(se.BP,{layerStyle:"ccIcon"}))),inputProps:({onChange:t})=>ze(ze({},d.number.inputProps),{},{onChange(r){const a=r.target.value.replace(/[^0-9 ]+/,""),{card:n}=je().number(a),s=n?(0,Te.OE)(a,n):a;return e.setValue("cardType",(null==n?void 0:n.type)||""),t(s)}})}),p&&(null===(r=e.getValues().number)||void 0===r?void 0:r.length)>2&&n.createElement(Re.t,{width:"60px"},n.createElement(p,{layerStyle:"ccIcon"}))),n.createElement(D.A,d.holder),n.createElement(te.r,{columns:[2,2,3],spacing:5},n.createElement(D.A,(0,O.A)({},d.expiry,{inputProps:({onChange:e})=>ze(ze({},d.expiry.inputProps),{},{onChange(t){let r=t.target.value.replace("/","");if(!(r.match(/[^\d|/]/g)||r.length>4))return r.length>=2&&(r=`${r.substr(0,2)}/${r.substr(2)}`),e(r)},onKeyDown(t){if(8===t.keyCode||46===t.keyCode)return t.preventDefault(),e(t.target.value.slice(0,-1))}})})),n.createElement(D.A,(0,O.A)({},d.securityCode,{formLabel:n.createElement(n.Fragment,null,n.createElement(De.l,{display:"inline",mr:1},d.securityCode.label),n.createElement(i.a,{onMouseEnter:f,onFocus:f,as:"span"},n.createElement(Le.m,{hasArrow:!0,placement:"top",label:m,shouldWrapChildren:!0,isOpen:l},n.createElement(se.mo,{boxSize:5,color:"gray.700","aria-label":a({id:"credit_card_fields.tool_tip.security_code_aria_label",defaultMessage:[{type:0,value:"Security code info"}]})}))))})))),n.createElement(D.A,d.cardType))};Ve.propTypes={form:b().object.isRequired,prefix:b().string};const Ge=Ve,He=({form:e,onSubmit:t})=>{const{formatMessage:r}=(0,s.A)(),{data:a}=(0,_.X)(),{currency:o}=(0,Pe.H2)();return n.createElement("form",{onSubmit:e.handleSubmit(t)},n.createElement(u.B,{spacing:8},n.createElement(u.B,{spacing:5},n.createElement(i.a,{border:"1px solid",borderColor:"gray.100",rounded:"base",overflow:"hidden"},n.createElement(Me.z,{value:"cc"},n.createElement(i.a,{py:3,px:[4,4,6],bg:"gray.50",borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(Oe.s,{value:"cc"},n.createElement(ke.s,{justify:"space-between"},n.createElement(u.B,{direction:"row",align:"center"},n.createElement(k.E,{fontWeight:"bold"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Credit Card"}],id:"payment_selection.heading.credit_card"})),n.createElement(Le.m,{hasArrow:!0,placement:"top",label:r({defaultMessage:[{type:0,value:"This is a secure SSL encrypted payment."}],id:"payment_selection.tooltip.secure_payment"})},n.createElement(se.XA,{color:"gray.700",boxSize:5}))),n.createElement(k.E,{fontWeight:"bold"},n.createElement(Q.Gr,{value:null==a?void 0:a.orderTotal,style:"currency",currency:o}))))),n.createElement(i.a,{p:[4,4,6],borderBottom:"1px solid",borderColor:"gray.100"},n.createElement(u.B,{spacing:6},n.createElement(u.B,{spacing:6},n.createElement(Ge,{form:e})))),n.createElement(i.a,{py:3,px:[4,4,6],bg:"gray.50",borderColor:"gray.100"},n.createElement(Oe.s,{value:"paypal"},n.createElement(i.a,{py:"2px"},n.createElement(se.xt,{width:"auto",height:"20px"})))))))))};He.propTypes={form:b().object,onSubmit:b().func};const qe=He;var We=r(91214);const Ue=["removePromoCode"],Xe=["addressId","creationDate","lastModified","preferred"];function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(r),!0).forEach(function(t){(0,y.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const Je=({payment:e})=>{var t;const r=(0,Te.N0)(null==e||null===(t=e.paymentCard)||void 0===t?void 0:t.cardType);return n.createElement(u.B,{direction:"row",alignItems:"center",spacing:3},r&&n.createElement(r,{layerStyle:"ccIcon"}),n.createElement(u.B,{direction:"row"},n.createElement(k.E,null,e.paymentCard.cardType),n.createElement(k.E,null,"•••• ",e.paymentCard.numberLastDigits),n.createElement(k.E,null,e.paymentCard.expirationMonth,"/",e.paymentCard.expirationYear)))};Je.propTypes={payment:b().object};const Qe=()=>{var e;const{formatMessage:t}=(0,s.A)(),{data:r}=(0,_.X)(),d=(null==r?void 0:r.shipments)&&(null==r||null===(e=r.shipments[0])||void 0===e?void 0:e.shippingAddress),c=null==r?void 0:r.billingAddress,p=(null==r?void 0:r.paymentInstruments)&&(null==r?void 0:r.paymentInstruments[0]),[m,f]=(0,n.useState)(!0),{mutateAsync:y}=(0,q.useShopperBasketsMutation)("addPaymentInstrumentToBasket"),{mutateAsync:E}=(0,q.useShopperBasketsMutation)("updateBillingAddressForBasket"),{mutateAsync:b}=(0,q.useShopperBasketsMutation)("removePaymentInstrumentFromBasket"),h=(0,Be.d)(),{step:v,STEPS:A,goToStep:S,goToNextStep:I}=M(),C=(0,L.mN)({mode:"onChange",shouldUnregister:!1,defaultValues:Ke({},c)}),P=(0,We.mx)(),{removePromoCode:w}=P,x=(0,Z.A)(P,Ue),B=(0,L.mN)(),T=function(){var e=(0,a.A)(function*(e){const[t,a]=e.expiry.split("/"),n={paymentMethodId:"CREDIT_CARD",paymentCard:{holder:e.holder,maskedNumber:(0,Te.v1)(e.number),cardType:(0,Te.i2)(e.cardType),expirationMonth:parseInt(t),expirationYear:parseInt(`20${a}`)}};return y({parameters:{basketId:null==r?void 0:r.basketId},body:n})});return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,a.A)(function*(){if(!(yield C.trigger()))return;const e=m?d:C.getValues(),{addressId:t,creationDate:a,lastModified:n,preferred:s}=e,l=(0,Z.A)(e,Xe);return yield E({body:l,parameters:{basketId:r.basketId}})});return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,a.A)(function*(){try{yield b({parameters:{basketId:r.basketId,paymentInstrumentId:p.paymentInstrumentId}})}catch(e){h({title:t(U.gS),status:"error"})}});return function(){return e.apply(this,arguments)}}(),$=B.handleSubmit(function(){var e=(0,a.A)(function*(e){p||(yield T(e)),(yield N())&&I()});return function(t){return e.apply(this,arguments)}}()),F=(0,Q.zR)({defaultMessage:[{type:0,value:"Billing Address Form"}],id:"checkout_payment.label.billing_address_form"});return n.createElement(j.Le,{id:"step-3",title:t({defaultMessage:[{type:0,value:"Payment"}],id:"checkout_payment.title.payment"}),editing:v===A.PAYMENT,isLoading:B.formState.isSubmitting||C.formState.isSubmitting,disabled:null==p,onEdit:()=>S(A.PAYMENT),editLabel:t({defaultMessage:[{type:0,value:"Edit Payment Info"}],id:"toggle_card.action.editPaymentInfo"})},n.createElement(j.hl,null,n.createElement(i.a,{mt:-2,mb:4},n.createElement(We.rv,(0,O.A)({},x,{itemProps:{border:"none"}}))),n.createElement(u.B,{spacing:6},null!=p&&p.paymentCard?n.createElement(u.B,{spacing:3},n.createElement(ee.D,{as:"h3",fontSize:"md"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Credit Card"}],id:"checkout_payment.heading.credit_card"})),n.createElement(u.B,{direction:"row",spacing:4},n.createElement(Je,{payment:p}),n.createElement(g.$,{variant:"link",size:"sm",colorScheme:"red",onClick:D},n.createElement(l.A,{defaultMessage:[{type:0,value:"Remove"}],id:"checkout_payment.action.remove"})))):n.createElement(qe,{form:B,onSubmit:T}),n.createElement(R.c,{borderColor:"gray.100"}),n.createElement(u.B,{spacing:2},n.createElement(ee.D,{as:"h3",fontSize:"md"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Billing Address"}],id:"checkout_payment.heading.billing_address"})),n.createElement(xe.S,{name:"billingSameAsShipping",isChecked:m,onChange:e=>f(e.target.checked)},n.createElement(k.E,{fontSize:"sm",color:"gray.700"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Same as shipping address"}],id:"checkout_payment.label.same_as_shipping"}))),m&&d&&n.createElement(i.a,{pl:7},n.createElement(ce.A,{address:d}))),!m&&n.createElement(Ae,{form:C,selectedAddress:c,formTitleAriaLabel:F,hideSubmitButton:!0,isBillingAddress:!0}),n.createElement(i.a,{pt:3},n.createElement(o.m,{variant:"form"},n.createElement(g.$,{w:"full",onClick:$},n.createElement(l.A,{defaultMessage:[{type:0,value:"Review Order"}],id:"checkout_payment.button.review_order"})))))),n.createElement(j.vr,null,n.createElement(u.B,{spacing:6},p&&n.createElement(u.B,{spacing:3},n.createElement(ee.D,{as:"h3",fontSize:"md"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Credit Card"}],id:"checkout_payment.heading.credit_card"})),n.createElement(Je,{payment:p})),n.createElement(R.c,{borderColor:"gray.100"}),c&&n.createElement(u.B,{spacing:2},n.createElement(ee.D,{as:"h3",fontSize:"md"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Billing Address"}],id:"checkout_payment.heading.billing_address"})),n.createElement(ce.A,{address:c})))))};var Ze=r(8804),et=r(61892);const tt=()=>n.createElement(i.a,{background:"gray.50",flex:"1"},n.createElement(o.m,{"data-testid":"sf-checkout-skeleton",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:4}},n.createElement(d.x,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,lg:20}},n.createElement(c.E,null,n.createElement(u.B,{spacing:4},n.createElement(et.E,{height:"78px"}),n.createElement(et.E,{height:"78px"}),n.createElement(et.E,{height:"78px"}),n.createElement(et.E,{height:"78px"}))),n.createElement(c.E,{py:6,px:[4,4,0]},n.createElement(u.B,{spacing:5},n.createElement(et.E,{height:"30px",width:"50%"}),n.createElement(u.B,{spacing:5},n.createElement(et.E,{height:"30px",width:"65%"}),n.createElement(u.B,{w:"full",py:4,borderY:"1px",borderColor:"gray.200"},n.createElement(et.E,{height:6}),n.createElement(et.E,{height:6}),n.createElement(et.E,{height:6})),n.createElement(et.E,{height:6})))))));var rt=r(70871),at=r(6803);const nt=()=>{const{formatMessage:e}=(0,s.A)(),t=(0,f.A)(),{step:r}=M(),[y,E]=(0,n.useState)(),{data:b}=(0,_.X)(),[h,v]=(0,n.useState)(!1),{mutateAsync:A}=(0,q.useShopperOrdersMutation)("createOrder"),{passwordless:S={},social:I={}}=(0,W.getConfig)().app.login||{},C=null==I?void 0:I.idps,O=!(null==I||!I.enabled),k=!(null==S||!S.enabled);(0,n.useEffect)(()=>{(y||4===r)&&window.scrollTo({top:0})},[y,r]);const P=function(){var r=(0,a.A)(function*(){v(!0);try{const e=yield A({body:{basketId:b.basketId}});t(`/checkout/confirmation/${e.orderNo}`)}catch(t){const r=e({id:"checkout.message.generic_error",defaultMessage:[{type:0,value:"An unexpected error occurred during checkout."}]});E(r)}finally{v(!1)}});return function(){return r.apply(this,arguments)}}();return n.createElement(i.a,{background:"gray.50",flex:"1"},n.createElement(o.m,{"data-testid":"sf-checkout-container",maxWidth:"container.xl",py:{base:7,lg:16},px:{base:0,lg:8}},n.createElement(d.x,{templateColumns:{base:"1fr",lg:"66% 1fr"},gap:{base:10,xl:20}},n.createElement(c.E,null,n.createElement(u.B,{spacing:4},y&&n.createElement(p.F,{status:"error",variant:"left-accent"},n.createElement(m._,null),y),n.createElement(K,{isSocialEnabled:O,isPasswordlessEnabled:k,idps:C}),n.createElement(Ce,null),n.createElement(we,null),n.createElement(Qe,null),4===r&&n.createElement(i.a,{pt:3,display:{base:"none",lg:"block"}},n.createElement(o.m,{variant:"form"},n.createElement(g.$,{w:"full",onClick:P,isLoading:h,"data-testid":"sf-checkout-place-order-btn"},n.createElement(l.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),n.createElement(c.E,{py:6,px:[4,4,4,0]},n.createElement(Ze.A,{basket:b,showTaxEstimationForm:!1,showCartItems:!0}),4===r&&n.createElement(i.a,{display:{base:"none",lg:"block"},pt:2},n.createElement(g.$,{w:"full",onClick:P,isLoading:h},n.createElement(l.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))),4===r&&n.createElement(i.a,{display:{lg:"none"},position:"sticky",bottom:"0",px:4,pt:6,pb:11,background:"white",borderTop:"1px solid",borderColor:"gray.100"},n.createElement(o.m,{variant:"form"},n.createElement(g.$,{w:"full",onClick:P,isLoading:h},n.createElement(l.A,{defaultMessage:[{type:0,value:"Place Order"}],id:"checkout.button.place_order"})))))},st=()=>{const{data:e}=(0,v.J)(),{data:t}=(0,_.X)(),{formatMessage:r}=(0,s.A)(),l=(0,q.useShopperBasketsMutation)("removeItemFromBasket"),i=(0,Be.d)(),[o,d]=(0,n.useState)(!1),c=function(){var e=(0,a.A)(function*(e){yield l.mutateAsync({parameters:{basketId:t.basketId,itemId:e.itemId}},{onSuccess:()=>{i({title:r(U.Tq,{quantity:1}),status:"success"})},onError:()=>{i({title:r(U.gS),status:"error"})}})});return function(t){return e.apply(this,arguments)}}(),u=function(){var e=(0,a.A)(function*(e){var r;d(!0);const a=null==t||null===(r=t.productItems)||void 0===r?void 0:r.filter(t=>null==e?void 0:e.includes(t.productId));for(let e of a)yield c(e);d(!1)});return function(t){return e.apply(this,arguments)}}();return e&&e.customerId&&t&&t.basketId?n.createElement(C,null,o&&n.createElement(at.A,{wrapperStyles:{height:"100vh"}}),n.createElement(nt,null),n.createElement(rt.A,{productItems:null==t?void 0:t.productItems,handleUnavailableProducts:u})):n.createElement(tt,null)}}}]);