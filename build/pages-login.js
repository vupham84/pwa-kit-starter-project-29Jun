"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[729],{52236:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var a=s(28407),r=s(77810),n=s(75826),o=s.n(n),i=s(16602),l=s(34692),u=s(59146),c=s(69290),m=s(90031),d=s(84470),p=s(17364),g=s(49785),f=s(64965),S=s(72105),y=s(39068),A=s(18223),h=s(66322),E=s(20513),b=s(1188),w=s(4026);const _=(0,i.zR)({defaultMessage:[{type:0,value:"Incorrect username or password, please try again."}],id:"login_page.error.incorrect_username_or_password"}),v="login",C="email",L=({initialView:e=v})=>{const{formatMessage:t}=(0,l.A)(),s=(0,d.A)(),n=(0,g.mN)(),o=(0,f.zy)(),i=new URLSearchParams(o.search),{path:L}=(0,f.W5)(),k=(0,S.A)(),{isRegistered:D,customerType:P}=(0,m.useCustomerType)(),R=(0,m.useAuthHelper)(m.AuthHelpers.LoginRegisteredUserB2C),B=(0,m.useAuthHelper)(m.AuthHelpers.LoginPasswordlessUser),O=(0,m.useAuthHelper)(m.AuthHelpers.AuthorizePasswordless),{passwordless:T={},social:H={}}=(0,w.getConfig)().app.login||{},U=!(null==T||!T.enabled),I=!(null==H||!H.enabled),W=null==H?void 0:H.idps,j=(0,m.useCustomerId)(),F=(0,E.Z)(P),{data:z,isSuccess:N}=(0,m.useCustomerBaskets)({parameters:{customerId:j}},{enabled:!!j&&!b.S$,keepPreviousData:!0}),Y=(0,m.useShopperBasketsMutation)("mergeBasket"),[M,V]=(0,r.useState)(e),[K,$]=(0,r.useState)(""),[x,Z]=(0,r.useState)(h.Y3.PASSWORD),[q,G]=(0,r.useState)(""),J=()=>{var e,s,a;if((null==z||null===(e=z.baskets)||void 0===e||null===(s=e[0])||void 0===s||null===(a=s.productItems)||void 0===a?void 0:a.length)>0&&"guest"===F)try{Y.mutate({headers:{"Content-Type":"application/json"},parameters:{createDestinationBasket:!0}})}catch(e){n.setError("global",{type:"manual",message:t(h.gS)})}},Q=function(){var e=(0,a.A)(function*(e){n.clearErrors();const s=function(){var e=(0,a.A)(function*(e){try{yield O.mutateAsync({userid:e}),V(C)}catch(e){const s=h.C5.test(e.message)?t(h.j$):h.Fk.some(t=>t.test(e.message))?t(h.vn):t(h.gS);n.setError("global",{type:"manual",message:s})}});return function(t){return e.apply(this,arguments)}}();return{login:(o=(0,a.A)(function*(e){if(x===h.Y3.PASSWORD){try{yield R.mutateAsync({username:e.email,password:e.password})}catch(e){const s=/Unauthorized/i.test(e.message)?t(_):t(h.gS);n.setError("global",{type:"manual",message:s})}J()}else x===h.Y3.PASSWORDLESS&&($(e.email),yield s(e.email))}),function(e){return o.apply(this,arguments)}),email:(r=(0,a.A)(function*(){yield s(K)}),function(){return r.apply(this,arguments)})}[M](e);var r,o});return function(t){return e.apply(this,arguments)}}();return(0,r.useEffect)(()=>{if(L===h.bW&&N){const e=decodeURIComponent(i.get("token"));i.get("redirect_url")?G(decodeURIComponent(i.get("redirect_url"))):G(""),function(){var s=(0,a.A)(function*(){try{yield B.mutateAsync({pwdlessLoginToken:e})}catch(e){var s;const a=yield null===(s=e.response)||void 0===s?void 0:s.json(),r=h.Fn.test(a.message)?t(h.jk):t(h.gS);n.setError("global",{type:"manual",message:r})}});return function(){return s.apply(this,arguments)}}()()}},[L,N]),(0,r.useEffect)(()=>{D&&(J(),s(q||"/account"))},[D,q]),(0,r.useEffect)(()=>{k.sendViewPage(o.pathname)},[]),r.createElement(u.a,{"data-testid":"login-page",bg:"gray.50",py:[8,16]},r.createElement(p.A,{title:"Sign in",description:"Customer sign in"}),r.createElement(c.m,{paddingTop:16,width:["100%","407px"],bg:"white",paddingBottom:14,marginTop:8,marginBottom:8,borderRadius:"base"},!n.formState.isSubmitSuccessful&&M===v&&r.createElement(y.A,{form:n,submitForm:Q,clickCreateAccount:()=>s("/registration"),handlePasswordlessLoginClick:()=>{Z(h.Y3.PASSWORDLESS)},handleForgotPasswordClick:()=>s("/reset-password"),isPasswordlessEnabled:U,isSocialEnabled:I,idps:W,setLoginType:Z}),n.formState.isSubmitSuccessful&&M===C&&r.createElement(A.A,{form:n,submitForm:Q,email:K})))};L.getTemplateName=()=>"login",L.propTypes={initialView:o().oneOf([v,C]),match:o().object};const k=L}}]);